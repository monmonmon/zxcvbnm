(function(){$.ajaxSetup({cache:false});$(function(){var storage=$.jStorage;var is_mobile=$("html.mobile").size()>0?true:false;var is_ie=$("html.ie").size()>0?true:false;var is_not_html_on_flash=$("html.not_html_on_flash").size()>0?true:false;if(!is_mobile){var $delete_confirm_dialog=$("#delete-confirm-dialog");var is_delete_confirm_dialog_open=false;var $report_confirm_dialog=$("#report_confirm_dialog");var is_report_confirm_dialog_open=false;var $embed_dialog=$("#embed_dialog");var is_embed_dialog_open=false;var $embed_button=$(".embed_button");var embed_dialog_initialized=false;var $dialog=$("#delete-confirm-dialog, #report_confirm_dialog, #embed_dialog");var closeAllDialog=function(){if(is_delete_confirm_dialog_open){$delete_confirm_dialog.dialog("close");is_delete_confirm_dialog_open=false}if(is_report_confirm_dialog_open){$report_confirm_dialog.dialog("close");is_report_confirm_dialog_open=false}if(is_embed_dialog_open){$embed_dialog.dialog("close");is_embed_dialog_open=false}};if(is_not_html_on_flash){$delete_confirm_dialog.dialog({autoOpen:false,resizable:false,closeOnEscape:false,buttons:{OK:function(){$(this).dialog("close");$("#delete_sphere_form").submit()},Cancel:function(){$(this).dialog("close")}},appendTo:".sphere_information",open:function(){initDialogPositionAfterFlash($(this))}})}else{$delete_confirm_dialog.dialog({autoOpen:false,resizable:false,closeOnEscape:false,modal:true,buttons:{OK:function(){$(this).dialog("close");$("#delete_sphere_form").submit()},Cancel:function(){$(this).dialog("close")}}})}$(".sphere_information p.delete").click(function(event){if(is_delete_confirm_dialog_open){closeAllDialog()}else{closeAllDialog();$delete_confirm_dialog.dialog("open");if(is_not_html_on_flash){scrollDialogPosition($delete_confirm_dialog)}is_delete_confirm_dialog_open=true}event.preventDefault();return false});$delete_confirm_dialog.parent().on("clickoutside",function(){if(is_delete_confirm_dialog_open){$delete_confirm_dialog.dialog("close");is_delete_confirm_dialog_open=false}});if(is_not_html_on_flash){$report_confirm_dialog.dialog({autoOpen:false,resizable:false,closeOnEscape:false,width:480,buttons:[{id:"report_ok",disabled:"disabled",text:I18n.report_ok,click:function(){$(this).dialog("close");$("#report_form").submit()}},{id:"report_cancel",text:I18n.report_cancel,click:function(){$(this).dialog("close")}}],appendTo:".sphere_information",open:function(){initDialogPositionAfterFlash($(this))}})}else{$report_confirm_dialog.dialog({autoOpen:false,resizable:false,closeOnEscape:false,modal:true,width:480,buttons:[{id:"report_ok",disabled:"disabled",text:I18n.report_ok,click:function(){$(this).dialog("close");$("#report_form").submit()}},{id:"report_cancel",text:I18n.report_cancel,click:function(){$(this).dialog("close")}}]})}$("p.report.active").click(function(event){if(is_report_confirm_dialog_open){closeAllDialog()}else{closeAllDialog();$report_confirm_dialog.dialog("open");if(is_not_html_on_flash){scrollDialogPosition($report_confirm_dialog)}is_report_confirm_dialog_open=true}event.preventDefault();return false});$report_confirm_dialog.parent().on("clickoutside",function(){if(is_report_confirm_dialog_open){$report_confirm_dialog.dialog("close");is_report_confirm_dialog_open=false}});$("p.report.inactive").click(function(event){window.location=$("#menu .login a").attr("href")});var $reason=$("#reason");$reason.maxlength();$reason.on("textchange",function(){if($("#reason").val().length>0){$("#report_ok").button("enable")}else{$("#report_ok").button("disable")}});$reason.ahPlaceholder();var $embed_code=$("#embed_dialog textarea");$embed_code.on("focus",function(){$(this).select()}).on("click",function(){$(this).select();return false});$embed_button.on("click",function(){if(embed_dialog_initialized&&$embed_dialog.dialog("isOpen")){closeAllDialog();return false}else{if(embed_dialog_initialized&&!$embed_dialog.dialog("isOpen")){closeAllDialog();$embed_dialog.dialog("open");is_embed_dialog_open=true;return false}else{closeAllDialog();if(is_not_html_on_flash){$embed_dialog.dialog({width:"auto",appendTo:".sphere_information",open:function(){initDialogPositionAfterFlash($(this));scrollDialogPosition($embed_dialog)}})}else{var x=$embed_button.offset().left-(is_ie?$("html:first").scrollLeft():0);var y=$embed_button.offset().top-(is_ie?$("html:first").scrollTop():0);var dialog_width=parseInt($embed_code.css("width"));$embed_dialog.dialog({position:[x-dialog_width+$embed_button.width()-44,y+28],width:"auto"})}is_embed_dialog_open=true;initEmbedDialog();embed_dialog_initialized=true;return false}}});var initEmbedDialog=function(){$embed_dialog.parent().on("clickoutside",function(){if(is_embed_dialog_open){$embed_dialog.dialog("close");is_embed_dialog_open=false}})};$('input[name="playmode_autoplay"]:radio').change(function(){var radio_value=$(this).val();var $embed_code_string=$embed_code[0].value;if(radio_value=="on"&&$embed_code_string.match(/(.+) data-mode=\"click2play\"(.+)(\n.+)/)){$embed_code[0].value=(RegExp.$1+RegExp.$2+RegExp.$3)}else{if(radio_value=="off"&&$embed_code_string.match(/(.+)blockquote (.+)(\n.+)/)){$embed_code[0].value=(RegExp.$1+'blockquote data-mode="click2play" '+RegExp.$2+RegExp.$3)}}$embed_code.focus()}).on("click",function(){$embed_code.focus()})}else{var $reason=$("#reason");$reason.maxlength();$reason.on("textchange",function(){if($("#reason").val().length>0){$("#report_ok").button("enable")}else{$("#report_ok").button("disable")}});$reason.ahPlaceholder();$("#delete-confirm-dialog, #sphere_information, #report_confirm_dialog").on("pagehide",function(){touchEventOn()});$("#delete-confirm-dialog, #sphere_information, #report_confirm_dialog").on("pageshow",function(){touchEventOff()})}function scrollDialogPosition($dialog){var window_bottom_height=$(window).scrollTop()+$(window).height();var $target=$dialog.parent(".ui-dialog");var target_bottom_height=$target.offset().top+$target.height();if(target_bottom_height>window_bottom_height){var dialog_bottom_height=$(window).scrollTop()+(target_bottom_height-window_bottom_height);$(window).scrollTop(dialog_bottom_height)}}function initDialogPositionAfterFlash($dialog){var position_y=$(".sphere_information").height();$dialog.parent(".ui-dialog").css("top",position_y)}function centering_image($img){var window_width=$(".embed .no_autoplay").width();var window_height=$(".embed .no_autoplay").height();var img_width=$img.width();if(img_width>=window_width){$img.css("left",(window_width-img_width)/2+"px")}else{$img.css({width:"100%",height:"auto",top:(window_height-window_height*window_width/img_width)/2+"px"})}}var $no_autoplay_embed_img=$(".embed .no_autoplay img.thumbnail");if($no_autoplay_embed_img.size()>0){if($no_autoplay_embed_img.width()>0){centering_image($no_autoplay_embed_img)}else{$no_autoplay_embed_img.on("load",function(){centering_image($no_autoplay_embed_img)})}}var $post_date=$(".post_date");if($post_date.size()>0){var system_timezone=-(new Date()).getTimezoneOffset()/60;var cookie_timezone=$.cookie("tz");if(system_timezone!==parseFloat(cookie_timezone)){var tz=String(system_timezone);$.cookie("tz",tz,{path:"/"});$.getJSON(Sphere.url+".json?tz="+tz,function(json){$post_date.html(json.post_date_screen_html)})}}var nm=$("html.nm").size()>0;var $store_banner=$(".store_banner");if($store_banner.size()>0&&!nm){$.get("/"+$store_banner.data("locale")+"/common/html/banner.html",function(data){$store_banner.html(data)})}var $store_banner_m=$("#receptor_introduction_m");if($store_banner_m.size()>0&&!nm){$.get("/"+$store_banner_m.data("locale")+"/common/html/banner_m.html",function(data){$store_banner_m.html(data)})}var notes;if(is_mobile){notes=$(".note")}else{notes=$(".content.note p")}var tagExtractRegex=/(^|[ 　\t\r\n>])([#＃][^ 　\t\r\n<]+)/g;notes.each(function(){var note=$(this);var tagLinked=note.html().replace(tagExtractRegex,function(str,p1,p2,offset,s){var displayTagName=p2;var tagName=displayTagName.replace(/[０-９]/g,function(s){return String.fromCharCode(s.charCodeAt(0)-65248)});if(/^[#＃]((デザフェス360)|(theta360LA))$/i.test(tagName)){var url="/tags/"+encodeURIComponent(displayTagName.replace(/^[#＃]/,""));return p1+'<a href="'+url+'">'+displayTagName+"</a>"}else{return str}});note.html(tagLinked)})})}).call(this);